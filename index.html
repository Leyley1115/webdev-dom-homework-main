<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments">
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
     <style>
    .error{
      background-color: rgb(255, 124, 124);
    }
  </style>

  <script>
    const list = document.querySelector(".comments");
    const add = document.querySelector(".add-form-button");
    const name = document.querySelector(".add-form-name");
    const text = document.querySelector(".add-form-text");

  let counter = 0;
  const commentBox = [
    {name: 'Глеб Фокин', data: '12.02.22 12:18', comment: 'Это будет первый комментарий на этой странице', likes: `${counter+3}`, likeActive: ""},
    {name: 'Варвара Н.', data: '13.02.22 19:22', comment: 'Мне нравится как оформлена эта страница! ❤', likes: `${counter+75}`, likeActive: "-active-like"}
  ]

const like = () => {
  const likeButtons = document.querySelectorAll(".like-button");

  for (const likeButton of likeButtons) {
    likeButton.addEventListener("click", () => {
      const index = likeButton.dataset.index;
      const comment = commentBox[index];
      const likesCounter = likeButton.parentElement.querySelector(".likes-counter");

    if (comment.likeActive === "") {
      comment.likes++;
      comment.likeActive = "-active-like";

    } else {
      comment.likes--;
      comment.likeActive = "";
    }

    likesCounter.textContent = comment.likes;
    commentsRender();
    });
  }
};


const commentsRender = () => {
    const commentsHTML = commentBox.map((commentOne, index) => {
    return `<li class="comment">
          <div class="comment-header">
            <div>${commentOne.name}</div>
            <div>${commentOne.data}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              ${commentOne.comment}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">${commentOne.likes}</span>
              <button class="like-button ${commentOne.likeActive}" data-index="${index}"></button>
            </div>
          </div>
        </li>`
    }).join("");

  list.innerHTML = commentsHTML;

  like();
}
commentsRender();

add.addEventListener("click", ()=>{
  name.classList.remove("error");
  text.classList.remove("error");
  if (name.value === ""){
    name.classList.add("error");
    return
  }
  if (text.value === ""){
    text.classList.add("error");
    return
  }

  let options = {
    hour: 'numeric',
    minute: 'numeric'
  }
      
  let now = new Date();
  now = now.toLocaleDateString('ru-RU') + " " + now.toLocaleTimeString('ru-RU', options);

  const oldHTML = list.innerHTML;

  let newComment = {
    name: `${name.value}`, 
    data: `${now}`, 
    comment: `${text.value}`,
    likes: `${counter}`,
    likeActive: ""
  }

  commentBox.push(newComment)
    
  text.value="";
  name.value="";

  commentsRender();
});

  </script>
  </body>
</html>
